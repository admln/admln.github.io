{"title":"github repo:FCDN","date":"2023-01-04T20:16:25.000Z","date_formatted":{"ll":"Jan 4, 2023","L":"01/04/2023","MM-DD":"01-04"},"link":"2023/01/04/github-repo-FCDN","tags":["Github","SecTool"],"updated":"2023-01-04T12:28:59.871Z","content":"<h1 id=\"来源\">来源<a title=\"#来源\" href=\"#来源\"></a></h1>\n<p><a href=\"https://github.com/ccc-f/FCDN\" target=\"_blank\">https://github.com/ccc-f/FCDN</a></p>\n<p>批量检测域名是不是有CDN/WAF/DMZweb防护，找出疑是可以解析出真实IP的域名。</p>\n<p>不过根据它的逻辑，与其说是找真IP域名，不如说是过滤掉那些肯定被防护的域名。</p>\n<p>本身逻辑并不复杂。</p>\n<h1 id=\"原理\">原理<a title=\"#原理\" href=\"#原理\"></a></h1>\n<p>检测逻辑跟它的readme说的差不多，就使用dnspython模拟nslookup进行域名A记录解析，如果返回多个IP或者nameserver域名跟所查域名长度不一致即判断为CDN防护。然后剩下的就是可能是真实IP解析的域名。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">resolver = dns.resolver.Resolver()</span><br><span class=\"line\">resolver.nameservers = [<span class=\"string\">&#x27;1.1.1.1&#x27;</span>, <span class=\"string\">&#x27;8.8.8.8&#x27;</span>]</span><br><span class=\"line\">domain = domain.strip()</span><br><span class=\"line\">a = resolver.resolve(domain, <span class=\"string\">&#x27;A&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> index,value <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(a.response.answer):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> value.items:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> re.search(<span class=\"string\">r&#x27;\\d+\\.\\d+\\.\\d+\\.\\d+&#x27;</span>, j.to_text()):</span><br><span class=\"line\">            ipcount += <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ipcount &gt;= <span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">True</span>,domain</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> re.search(<span class=\"string\">r&#x27;(\\w+\\.)+&#x27;</span>, j.to_text()):</span><br><span class=\"line\">            cname = j.to_text()[:-<span class=\"number\">1</span>]</span><br><span class=\"line\">            length = <span class=\"built_in\">len</span>(cname)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> length != <span class=\"built_in\">len</span>(domain):</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">True</span>,domain</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">False</span>,domain</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span>,domain</span><br><span class=\"line\"><span class=\"keyword\">if</span> ipcount == <span class=\"number\">1</span>:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span>,domain</span><br></pre></td></tr></table></figure>\n<p>其他都是输入输出和多线程代码。</p>\n<h1 id=\"学习\">学习<a title=\"#学习\" href=\"#学习\"></a></h1>\n<ol>\n<li>\n<p>CDN防护确实是攻击方必然要考虑的，其相应的知识不可少；</p>\n</li>\n<li>\n<p>在线cdn检测网站：<a href=\"https://myssl.com/cdn_check.html%EF%BC%9B\" target=\"_blank\">https://myssl.com/cdn_check.html；</a></p>\n</li>\n<li>\n<p>多线程的简单实用；</p>\n</li>\n<li>\n<p>dnspython库的应用；</p>\n</li>\n</ol>\n<h1 id=\"缺点\">缺点<a title=\"#缺点\" href=\"#缺点\"></a></h1>\n<p>在它主动表示检测逻辑简单，只是有一个反其道而行之的亮点后，具体能力不谈，建议加一个扫子域名的功能。</p>\n<p>在拿到一个站点域名，还需要先解析出主域名的各个子域名再喂给它这个脚本去跑，如果能做到给个二级域名自动扫子域名+IP解析判断会更易用些。</p>\n","next":{"title":"github repo:TrackAttacker","link":"2023/01/04/github-repo-TrackAttacker"},"plink":"https://admln.github.io/2023/01/04/github-repo-FCDN/","toc":[{"id":"来源","title":"来源","index":"1"},{"id":"原理","title":"原理","index":"2"},{"id":"学习","title":"学习","index":"3"},{"id":"缺点","title":"缺点","index":"4"}],"copyright":{"published":"January 4, 2023","author":"Daemon X","link":"<a href=\"https://admln.github.io/2023/01/04/github-repo-FCDN/\" title=\"github repo:FCDN\">https://admln.github.io/2023/01/04/github-repo-FCDN/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"445 words in 3 min"}